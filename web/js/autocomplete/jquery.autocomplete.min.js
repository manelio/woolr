/**
 * @fileOverview jquery-autocomplete, the jQuery Autocompleter
 * @author <a href="mailto:dylan@dyve.net">Dylan Verheul</a>
 * @version 2.4.4
 * @requires jQuery 1.6+
 * @license MIT | GPL | Apache 2.0, see LICENSE.txt
 * @see https://github.com/dyve/jquery-autocomplete
 */
(function(e){"use strict";e.fn.autocomplete=function(t){var n;if(arguments.length>1){n=t;t=arguments[1];t.url=n}else if(typeof t==="string"){n=t;t={url:n}}var r=e.extend({},e.fn.autocomplete.defaults,t);return this.each(function(){var t=e(this);t.data("autocompleter",new e.Autocompleter(t,e.meta?e.extend({},r,t.data()):r))})};e.fn.autocomplete.defaults={inputClass:"acInput",loadingClass:"acLoading",resultsClass:"acResults",selectClass:"acSelect",queryParamName:"q",extraParams:{},remoteDataType:false,lineSeparator:"\n",cellSeparator:"|",minChars:2,maxItemsToShow:10,delay:400,useCache:true,maxCacheLength:10,matchSubset:true,matchCase:false,matchInside:true,mustMatch:false,selectFirst:false,selectOnly:false,showResult:null,preventDefaultReturn:1,preventDefaultTab:0,autoFill:false,filterResults:true,filter:true,sortResults:true,sortFunction:null,onItemSelect:null,onNoMatch:null,onFinish:null,matchStringConverter:null,beforeUseConverter:null,autoWidth:"min-width",useDelimiter:false,delimiterChar:",",delimiterKeyCode:188,processData:null,onError:null,enabled:true};var t=function(t){var n,r;var i=typeof t;if(i==="string"){n=t;r={}}else if(e.isArray(t)){n=t[0];r=t.slice(1)}else if(i==="object"){n=t.value;r=t.data}n=String(n);if(typeof r!=="object"){r={}}return{value:n,data:r}};var n=function(e,t,n){var r=parseInt(e,10);n=n||{};if(isNaN(r)||n.min&&r<n.min){r=t}return r};var r=function(e,t){return[e,encodeURIComponent(t)].join("=")};var i=function(t,n){var i=[];e.each(n,function(e,t){i.push(r(e,t))});if(i.length){t+=t.indexOf("?")===-1?"?":"&";t+=i.join("&")}return t};var s=function(e,t,n){e=String(e.value);t=String(t.value);if(!n){e=e.toLowerCase();t=t.toLowerCase()}if(e>t){return 1}if(e<t){return-1}return 0};var o=function(e,t,n){var r=[];var i,s,o,u,a,f;f=String(e).replace("\r\n","\n").split(t);for(i=0;i<f.length;i++){u=f[i].split(n);o=[];for(s=0;s<u.length;s++){o.push(decodeURIComponent(u[s]))}a=o.shift();r.push({value:a,data:o})}return r};e.Autocompleter=function(t,r){if(!t||!(t instanceof e)||t.length!==1||t.get(0).tagName.toUpperCase()!=="INPUT"){throw new Error("Invalid parameter for jquery.Autocompleter, jQuery object with one element with INPUT tag expected.")}var i=this;this.options=r;this.cacheData_={};this.cacheLength_=0;this.selectClass_="jquery-autocomplete-selected-item";this.keyTimeout_=null;this.finishTimeout_=null;this.lastKeyPressed_=null;this.lastProcessedValue_=null;this.lastSelectedValue_=null;this.active_=false;this.finishOnBlur_=true;this.options.minChars=n(this.options.minChars,e.fn.autocomplete.defaults.minChars,{min:0});this.options.maxItemsToShow=n(this.options.maxItemsToShow,e.fn.autocomplete.defaults.maxItemsToShow,{min:0});this.options.maxCacheLength=n(this.options.maxCacheLength,e.fn.autocomplete.defaults.maxCacheLength,{min:1});this.options.delay=n(this.options.delay,e.fn.autocomplete.defaults.delay,{min:0});if(this.options.preventDefaultReturn!=2){this.options.preventDefaultReturn=this.options.preventDefaultReturn?1:0}if(this.options.preventDefaultTab!=2){this.options.preventDefaultTab=this.options.preventDefaultTab?1:0}this.dom={};this.dom.$elem=t;this.dom.$elem.attr("autocomplete","off").addClass(this.options.inputClass);this.dom.$results=e("<div></div>").hide().addClass(this.options.resultsClass).css({position:"absolute"});e("body").append(this.dom.$results);t.keydown(function(e){i.lastKeyPressed_=e.keyCode;switch(i.lastKeyPressed_){case i.options.delimiterKeyCode:if(i.options.useDelimiter&&i.active_){i.selectCurrent()}break;case 35:case 36:case 16:case 17:case 18:case 37:case 39:break;case 38:e.preventDefault();if(i.active_){i.focusPrev()}else{i.activate()}return false;case 40:e.preventDefault();if(i.active_){i.focusNext()}else{i.activate()}return false;case 9:if(i.active_){i.selectCurrent();if(i.options.preventDefaultTab){e.preventDefault();return false}}if(i.options.preventDefaultTab===2){e.preventDefault();return false}break;case 13:if(i.active_){i.selectCurrent();if(i.options.preventDefaultReturn){e.preventDefault();return false}}if(i.options.preventDefaultReturn===2){e.preventDefault();return false}break;case 27:if(i.active_){e.preventDefault();i.deactivate(true);return false}break;default:i.activate()}});t.on("paste",function(){i.activate()});var s=function(){i.deactivate(true)};t.blur(function(){if(i.finishOnBlur_){i.finishTimeout_=setTimeout(s,200)}});t.parents("form").on("submit",s)};e.Autocompleter.prototype.position=function(){var t=this.dom.$elem.offset();var n=this.dom.$results.outerHeight();var r=e(window).outerHeight();var i=t.top+this.dom.$elem.outerHeight();var s=i+n;var o={top:i,left:t.left};if(s>r){var u=t.top-n;if(u>=0){o.top=u}}this.dom.$results.css(o)};e.Autocompleter.prototype.cacheRead=function(e){var t,n,r,i,s;if(this.options.useCache){e=String(e);t=e.length;if(this.options.matchSubset){n=1}else{n=t}while(n<=t){if(this.options.matchInside){i=t-n}else{i=0}s=0;while(s<=i){r=e.substr(0,n);if(this.cacheData_[r]!==undefined){return this.cacheData_[r]}s++}n++}}return false};e.Autocompleter.prototype.cacheWrite=function(e,t){if(this.options.useCache){if(this.cacheLength_>=this.options.maxCacheLength){this.cacheFlush()}e=String(e);if(this.cacheData_[e]!==undefined){this.cacheLength_++}this.cacheData_[e]=t;return this.cacheData_[e]}return false};e.Autocompleter.prototype.cacheFlush=function(){this.cacheData_={};this.cacheLength_=0};e.Autocompleter.prototype.callHook=function(t,n){var r=this.options[t];if(r&&e.isFunction(r)){return r(n,this)}return false};e.Autocompleter.prototype.activate=function(){if(!this.options.enabled)return;var e=this;if(this.keyTimeout_){clearTimeout(this.keyTimeout_)}this.keyTimeout_=setTimeout(function(){e.activateNow()},this.options.delay)};e.Autocompleter.prototype.activateNow=function(){var e=this.beforeUseConverter(this.dom.$elem.val());if(e!==this.lastProcessedValue_&&e!==this.lastSelectedValue_){this.fetchData(e)}};e.Autocompleter.prototype.fetchData=function(e){var t=this;var n=function(e,n){if(t.options.processData){e=t.options.processData(e)}t.showResults(t.filterResults(e,n),n)};this.lastProcessedValue_=e;if(e.length<this.options.minChars){n([],e)}else if(this.options.data){n(this.options.data,e)}else{this.fetchRemoteData(e,function(t){n(t,e)})}};e.Autocompleter.prototype.fetchRemoteData=function(t,n){var r=this.cacheRead(t);if(r){n(r)}else{var i=this;var s=i.options.remoteDataType==="json"?"json":"text";var o=function(e){var r=false;if(e!==false){r=i.parseRemoteData(e);i.cacheWrite(t,r)}i.dom.$elem.removeClass(i.options.loadingClass);n(r)};this.dom.$elem.addClass(this.options.loadingClass);e.ajax({url:this.makeUrl(t),success:o,error:function(t,n,r){if(e.isFunction(i.options.onError)){i.options.onError(t,n,r)}else{o(false)}},dataType:s})}};e.Autocompleter.prototype.setExtraParam=function(t,n){var r=e.trim(String(t));if(r){if(!this.options.extraParams){this.options.extraParams={}}if(this.options.extraParams[r]!==n){this.options.extraParams[r]=n;this.cacheFlush()}}return this};e.Autocompleter.prototype.makeUrl=function(t){var n=this;var r=this.options.url;var s=e.extend({},this.options.extraParams);if(this.options.queryParamName===false){r+=encodeURIComponent(t)}else{s[this.options.queryParamName]=t}return i(r,s)};e.Autocompleter.prototype.parseRemoteData=function(t){var n;var r=t;if(this.options.remoteDataType==="json"){n=typeof t;switch(n){case"object":r=t;break;case"string":r=e.parseJSON(t);break;default:throw new Error("Unexpected remote data type: "+n)}return r}return o(r,this.options.lineSeparator,this.options.cellSeparator)};e.Autocompleter.prototype.defaultFilter=function(e,t){if(!e.value){return false}if(this.options.filterResults){var n=this.matchStringConverter(t);var r=this.matchStringConverter(e.value);if(!this.options.matchCase){n=n.toLowerCase();r=r.toLowerCase()}var i=r.indexOf(n);if(this.options.matchInside){return i>-1}else{return i===0}}return true};e.Autocompleter.prototype.filterResult=function(t,n){if(this.options.filter===false){return true}if(e.isFunction(this.options.filter)){return this.options.filter(t,n)}return this.defaultFilter(t,n)};e.Autocompleter.prototype.filterResults=function(e,n){var r=[];var i,s;for(i=0;i<e.length;i++){s=t(e[i]);if(this.filterResult(s,n)){r.push(s)}}if(this.options.sortResults){r=this.sortResults(r,n)}if(this.options.maxItemsToShow>0&&this.options.maxItemsToShow<r.length){r.length=this.options.maxItemsToShow}return r};e.Autocompleter.prototype.sortResults=function(t,n){var r=this;var i=this.options.sortFunction;if(!e.isFunction(i)){i=function(e,t,n){return s(e,t,r.options.matchCase)}}t.sort(function(e,t){return i(e,t,n,r.options)});return t};e.Autocompleter.prototype.matchStringConverter=function(t,n,r){var i=this.options.matchStringConverter;if(e.isFunction(i)){t=i(t,n,r)}return t};e.Autocompleter.prototype.beforeUseConverter=function(t){t=this.getValue(t);var n=this.options.beforeUseConverter;if(e.isFunction(n)){t=n(t)}return t};e.Autocompleter.prototype.enableFinishOnBlur=function(){this.finishOnBlur_=true};e.Autocompleter.prototype.disableFinishOnBlur=function(){this.finishOnBlur_=false};e.Autocompleter.prototype.createItemFromResult=function(t){var n=this;var r=e("<li/>");r.html(this.showResult(t.value,t.data));r.data({value:t.value,data:t.data}).click(function(){n.selectItem(r)}).mousedown(n.disableFinishOnBlur).mouseup(n.enableFinishOnBlur);return r};e.Autocompleter.prototype.getItems=function(){return e(">ul>li",this.dom.$results)};e.Autocompleter.prototype.showResults=function(t,n){var r=t.length;var i=this;var s=e("<ul></ul>");var o,u,a,f,l=false,c=false;if(r){for(o=0;o<r;o++){u=t[o];a=this.createItemFromResult(u);s.append(a);if(l===false){l=String(u.value);c=a;a.addClass(this.options.firstItemClass)}if(o===r-1){a.addClass(this.options.lastItemClass)}}this.dom.$results.html(s).show();this.position();if(this.options.autoWidth){f=this.dom.$elem.outerWidth()-this.dom.$results.outerWidth()+this.dom.$results.width();this.dom.$results.css(this.options.autoWidth,f)}this.getItems().hover(function(){i.focusItem(this)},function(){});if(this.autoFill(l,n)||this.options.selectFirst||this.options.selectOnly&&r===1){this.focusItem(c)}this.active_=true}else{this.hideResults();this.active_=false}};e.Autocompleter.prototype.showResult=function(t,n){if(e.isFunction(this.options.showResult)){return this.options.showResult(t,n)}else{return e("<p></p>").text(t).html()}};e.Autocompleter.prototype.autoFill=function(e,t){var n,r,i,s;if(this.options.autoFill&&this.lastKeyPressed_!==8){n=String(e).toLowerCase();r=String(t).toLowerCase();i=e.length;s=t.length;if(n.substr(0,s)===r){var o=this.getDelimiterOffsets();var u=o.start?" ":"";this.setValue(u+e);var a=s+o.start+u.length;var f=i+o.start+u.length;this.selectRange(a,f);return true}}return false};e.Autocompleter.prototype.focusNext=function(){this.focusMove(+1)};e.Autocompleter.prototype.focusPrev=function(){this.focusMove(-1)};e.Autocompleter.prototype.focusMove=function(t){var r=this.getItems();t=n(t,0);if(t){for(var i=0;i<r.length;i++){if(e(r[i]).hasClass(this.selectClass_)){this.focusItem(i+t);return}}}this.focusItem(0)};e.Autocompleter.prototype.focusItem=function(t){var n,r=this.getItems();if(r.length){r.removeClass(this.selectClass_).removeClass(this.options.selectClass);if(typeof t==="number"){if(t<0){t=0}else if(t>=r.length){t=r.length-1}n=e(r[t])}else{n=e(t)}if(n){n.addClass(this.selectClass_).addClass(this.options.selectClass)}}};e.Autocompleter.prototype.selectCurrent=function(){var t=e("li."+this.selectClass_,this.dom.$results);if(t.length===1){this.selectItem(t)}else{this.deactivate(false)}};e.Autocompleter.prototype.selectItem=function(e){var t=e.data("value");var n=e.data("data");var r=this.displayValue(t,n);var i=this.beforeUseConverter(r);this.lastProcessedValue_=i;this.lastSelectedValue_=i;var s=this.getDelimiterOffsets();var o=this.options.delimiterChar;var u=this.dom.$elem;var a=0;if(this.options.useDelimiter){if(u.val().substring(s.start-1,s.start)==o&&o!=" "){r=" "+r}if(u.val().substring(s.end,s.end+1)!=o&&this.lastKeyPressed_!=this.options.delimiterKeyCode){r=r+o}else{a=1}}this.setValue(r);this.setCaret(s.start+r.length+a);this.callHook("onItemSelect",{value:t,data:n});this.deactivate(true);u.focus()};e.Autocompleter.prototype.displayValue=function(t,n){if(e.isFunction(this.options.displayValue)){return this.options.displayValue(t,n)}return t};e.Autocompleter.prototype.hideResults=function(){this.dom.$results.hide()};e.Autocompleter.prototype.deactivate=function(e){if(this.finishTimeout_){clearTimeout(this.finishTimeout_)}if(this.keyTimeout_){clearTimeout(this.keyTimeout_)}if(e){if(this.lastProcessedValue_!==this.lastSelectedValue_){if(this.options.mustMatch){this.setValue("")}this.callHook("onNoMatch")}if(this.active_){this.callHook("onFinish")}this.lastKeyPressed_=null;this.lastProcessedValue_=null;this.lastSelectedValue_=null;this.active_=false}this.hideResults()};e.Autocompleter.prototype.selectRange=function(e,t){var n=this.dom.$elem.get(0);if(n.setSelectionRange){n.focus();n.setSelectionRange(e,t)}else if(n.createTextRange){var r=n.createTextRange();r.collapse(true);r.moveEnd("character",t);r.moveStart("character",e);r.select()}};e.Autocompleter.prototype.setCaret=function(e){this.selectRange(e,e)};e.Autocompleter.prototype.getCaret=function(){var e=this.dom.$elem;var t=e[0];var n,r,i,s,o,u;if(t.createTextRange){r=document.selection;if(t.tagName.toLowerCase()!="textarea"){n=e.val();i=r.createRange().duplicate();i.moveEnd("character",n.length);if(i.text===""){s=n.length}else{s=n.lastIndexOf(i.text)}i=r.createRange().duplicate();i.moveStart("character",-n.length);o=i.text.length}else{i=r.createRange();u=i.duplicate();u.moveToElementText(t);u.setEndPoint("EndToEnd",i);s=u.text.length-i.text.length;o=s+i.text.length}}else{s=e[0].selectionStart;o=e[0].selectionEnd}return{start:s,end:o}};e.Autocompleter.prototype.setValue=function(e){if(this.options.useDelimiter){var t=this.dom.$elem.val();var n=this.getDelimiterOffsets();var r=t.substring(0,n.start);var i=t.substring(n.end);e=r+e+i}this.dom.$elem.val(e)};e.Autocompleter.prototype.getValue=function(e){if(this.options.useDelimiter){var t=this.getDelimiterOffsets();return e.substring(t.start,t.end).trim()}else{return e}};e.Autocompleter.prototype.getDelimiterOffsets=function(){var e=this.dom.$elem.val();if(this.options.useDelimiter){var t=e.substring(0,this.getCaret().start);var n=t.lastIndexOf(this.options.delimiterChar)+1;var r=e.substring(this.getCaret().start);var i=r.indexOf(this.options.delimiterChar);if(i==-1)i=e.length;i+=this.getCaret().start}else{n=0;i=e.length}return{start:n,end:i}}})(jQuery)
